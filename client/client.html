<!DOCTYPE html>
<html>

<head>
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <title>Pokedex</title>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.2/css/bulma.min.css">
</head>

<body class="has-background-light">
  <nav class="py-4 level has-background-danger-40">

    <p class="level-item has-text-white  title is-1 has-text-centered">
      Pokedex
    </p>
    <p class="level-item 	has-text-left "> <a href="./client2.html"
        class="button  has-background-link is-info has-text-white-ter has-text-left">
        <b>Doc Page</b>
      </a>
    </p>

  </nav>
  <section class="section has-background-grey-light">

    <h1 class="title mx-auto ">Search Pokedex</h1>
    <div class="columns">
      <div class="column">
        <h2 class="subtitle">
          All Pokemon
        </h2>
        <form id="getAllForm" action="/getAllPokemon">
          <label class="label">Method</label>
          <div class="field">
            <div class="control is-link is rounded">
              <select class="input theMethod">
                <option value="get">GET</option>
                <option value="head">HEAD</option>
              </select>
            </div>
          </div>
          <input type="submit" id="findAllBttn" class="button is-link ">
        </form>
      </div>
      <div class="column">
        <h2 class="subtitle">
          Find A Pokemon
        </h2>
        <form id="singleSearchForm" action="/getPokemon">
          <label class="label">Search By</label>
          <div class="field">
            <div class="control is-link ">
              <select class="input inputType is-rounded is-small">
                <option value="name">Name</option>
                <option value="id">ID Number</option>
              </select>
            </div>
          </div>
          <label class="label">Enter info</label>

          <div class="field">
            <div class="control">
              <input class="input is-link is-rounded theInput" name="input" type="text" placeholder="Text input">
            </div>
          </div>
          <label class="label">Method</label>
          <div class="field">
            <div class="control is-link is rounded">
              <select class="input theMethod">
                <option value="get">GET</option>
                <option value="head">HEAD</option>
              </select>
            </div>
          </div>
          <div class="field">
            <div class="control">
              <input type="submit" class="button is-link" />
            </div>
          </div>
        </form>
      </div>
      <div class="column">
        <h2 class="subtitle">
          Find Pokemon Evolution Chain
        </h2>
        <form id="evoForm" action="/getPokeLife" method="GET">
          <label class="label">Search By</label>
          <div class="field">
            <div class="control is-link ">
              <select class="input inputType is-rounded is-small">
                <option value="name">Name</option>
                <option value="id">ID Number</option>
              </select>
            </div>
          </div>
          <label class="label">Enter info</label>

          <div class="field">
            <div class="control">
              <input class="input is-link is-rounded theInput" name="input" type="text" placeholder="Text input">
            </div>
          </div>
          <label class="label">Method</label>
          <div class="field">
            <div class="control is-link is rounded">
              <select class="input theMethod">
                <option value="get">GET</option>
                <option value="head">HEAD</option>
              </select>
            </div>
          </div>
          <div class="field">
            <div class="control">
              <input type="submit" class="button is-link" />
            </div>
          </div>
        </form>
      </div>
      <div class="column">
        <h2 class="subtitle">
          Find Pokemon By Type
        </h2>
        <form id="getTypeForm" action="/getType" method="GET">
          <label class="label">Types</label>
          <div class="field">
            <div class="control">
              <select name="types" id="types" class="input theInput">
                <option value="Normal">Normal</option>
                <option value="Fire">Fire</option>
                <option value="Fighting">Fighting</option>
                <option value="Water">Water</option>
                <option value="Flying">Flying</option>
                <option value="Poision">Poision</option>
                <option value="Ground">Ground</option>
                <option value="Rock">Rock</option>
                <option value="Bug">Bug</option>
                <option value="Ghost">Ghost</option>
                <option value="Steel">Steel</option>
                <option value="Grass">Grass</option>
                <option value="Electric">Electric</option>
                <option value="Psychic">Psychic</option>
                <option value="Ice">Ice</option>
                <option value="Dragon">Dragon</option>
                <option value="Dark">Dark</option>
                <option value="Fairy">Fairy</option>
              </select>
            </div>
          </div>
          <label class="label">Method</label>
          <div class="field">
            <div class="control is-link is rounded">
              <select class="input theMethod">
                <option value="get">GET</option>
                <option value="head">HEAD</option>
              </select>
            </div>
          </div>
          <div class="field">
            <div class="control">
              <input type="submit" class="button is-link" />
            </div>
          </div>
        </form>
      </div>

  </section>
  <section class="section  is-large">
    <h1 class="title mx-auto has-text-dark">Results</h1>

    <section class="container has-background-black" id="content">
    </section>

  </section>
  <section class="section  has-background-danger-40">
    <h1 class="title mx-auto has-text-white-ter  ">Edit Pokedex</h1>
    <div class="columns">
      <div class="column is-one-quarter">
        <h2 class="subtitle has-text-white-ter">
          Change A Pokemon Image
        </h2>
        <form id="changeImageForm" action="/changeImage" method="POST">
          <label class="label has-text-black-ter	 ">Choose Pokemon</label>
          <div class="field">
            <div class="control is-link ">
              <select class="input inputType is-rounded is-small">
                <option value="name">Name</option>
                <option value="id">ID Number</option>
              </select>
            </div>
          </div>
          <div class="field">
            <div class="control is-link ">
              <input class="input theInput is-danger is-rounded" name="input" type="text" placeholder="Text input">
            </div>
          </div>
          <label class="label has-text-black-ter	">Enter an image URL</label>
          <div class="field">
            <div class="control">
              <input class="input  imageValue is-danger is-rounded" name="input" type="url" placeholder="Url Input">
            </div>
          </div>
          <div class="field">
            <div class="control">
              <input type="submit" value="changeImage" id="changeImgBttn" class="button is-link" />
            </div>
          </div>
        </form>
      </div>
      <div id="postResults" class="column"></div>
      <div class="column ">
        <h2 class=" has-text-white-ter subtitle">
          Add a Pokemon
        </h2>
        <form id="addPokemonForm" action="/addPokemon" method="POST">
          <div class="field">
            <label class="label has-text-black-ter	">Number</label>
            <div class="control">
              <input class="input numInput is-rounded" type="number" placeholder="Number">
            </div>
          </div>
          <div class="field">
            <label class="label has-text-black-ter	">Name</label>
            <div class="control">
              <input class="input nameInput is-rounded " type="text" placeholder="Name">
            </div>
          </div>

          <div class="field">
            <label class="label has-text-black-ter	">Image</label>
            <div class="control">
              <input class="input imgInput is-rounded" name="input" type="url" placeholder="Url Input">
            </div>
          </div>

          <div class="field">
            <label class="label has-text-black-ter	">Types</label>
            <div class="control">
              <div class="select">
                <select id="addPokeTypes" class=" input typesInput">
                </select>
              </div>
            </div>
          </div>
          <div class="field">
            <div class="control">
              <input class="button is-link" type="submit" placeholder="submit" value="addPokemon">
            </div>
          </div>
        </form>
      </div>
    </div>

  </section>


</body>
<script>

  const handleResponse = async (response, method) => {
    //console.log(response.status)
    const content = document.querySelector('#content');
    let htmlString;
    switch (response.status) {
      case 200: //success
        htmlString = `<b>Success</b>`;
        break;
      case 201: //created
        htmlString = '<b>Created</b>';
        break;
      case 204: //updated (no response back from server)
        htmlString = '<b>Updated (No Content)</b>';
        return;
      case 400: //bad request
        htmlString = `<b>Bad Request</b>`;
        break;
      default: //any other status code
        htmlString = `Error code not implemented by client.`;
        break;
    }

    if (method == 'get') {
      const obj = await response.json();

      // console.log(obj)

      if (obj.message) {

        htmlString += `<p>Message:${obj.message}</p>`
      } else {

        let jsonString = JSON.stringify(obj);
        htmlString += `<p>${jsonString}</p>`;
      }
    } else if (method == 'POST') {
      const obj = await response.json();

      //console.log(obj)

      htmlString += `<p>Message:${obj.message}</p>`
    }
    //console.log(htmlString)
    content.innerHTML = htmlString;

  }

  const sendPost = async (form) => {
    let formData
    const url = form.getAttribute('action');
    const method = form.getAttribute('method');
    if (url == "/changeImage") {
      const inputType = form.querySelector('.inputType').value;
      const input = form.querySelector('.theInput').value.trim();
      const imageUrl = form.querySelector('.imageValue').value;
      formData = `?inputType=${inputType}&value=${input}&link=${imageUrl}`;
    } else {
      const num = form.querySelector('.numInput').value;
      const name = form.querySelector('.nameInput').value.trim();
      const img = form.querySelector('.imgInput').value;
      const types = form.querySelector('.typesInput').value.trim();
      formData = `?num=${num}&name=${name}&img=${img}&type=${types}`;
    }

    let response = await fetch(url, {
      method: method,
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
        'Accept': 'application/json'
      },

      body: formData,

    });

    handleResponse(response, method);
  }

  const sendFetch = async (form) => {
    //console.log(form)
    let url = form.getAttribute('action');
    const method = form.querySelector('.theMethod').value;

    if (url == "/getType") {
      const input = form.querySelector('.theInput').value.trim();
      const formData = `?type=type&value=${input}`;
      url += formData;
    }
    else if (url !== "/getAllPokemon") {
      const inputType = form.querySelector('.inputType').value;
      const input = form.querySelector('.theInput').value.trim();
      const formData = `?type=${inputType}&value=${input}`;
      url += formData;
    };
    let response = await fetch(url, {
      method: method,
      headers: {
        'Accept': 'application/json'
      },
    });
    // form data
    handleResponse(response, method);
  }



  const init = () => {

    // load type dropdowns
    let typesSelect = document.querySelector("#types");
    let addPokeTypesSelect = document.querySelector("#addPokeTypes");
    addPokeTypesSelect.innerHTML = typesSelect.innerHTML;

    // add and get event forms
    const postEvent = (e) => {
      e.preventDefault();

      sendPost(e.target);
      return false;
    }


    const getEvent = (e) => {
      e.preventDefault();
      // console.log(e)
      sendFetch(e.target);
      return false;
    }

    //set up get all button
    //Set up get forms  
    const searchForm = document.querySelector('#singleSearchForm');
    const evoForm = document.querySelector('#evoForm');
    const typeSearchForm = document.querySelector('#getTypeForm');
    const getAllForm = document.querySelector('#getAllForm');

    searchForm.addEventListener('submit', getEvent);
    evoForm.addEventListener('submit', getEvent);
    typeSearchForm.addEventListener('submit', getEvent);
    getAllForm.addEventListener('submit', getEvent);
    // set up post forms
    const changeImageForm = document.querySelector('#changeImageForm');
    const addPokeForm = document.querySelector('#addPokemonForm');

    changeImageForm.addEventListener('submit', postEvent);
    addPokeForm.addEventListener('submit', postEvent);
  }

  window.onload = init;
</script>

</html>